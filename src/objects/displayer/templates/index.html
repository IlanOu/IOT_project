<!DOCTYPE html>
<html>
<head>
  <title>Chaîne dynamique</title>
  <link rel="stylesheet" href="./style.css">
</head>
<body>
  <div id="dynamic-content"></div>
  
  <script>
    const eventSource = new EventSource("/stream");
    eventSource.onmessage = (event) => {
      const data = event.data;
      const dynamicContent = document.getElementById('dynamic-content');
      dynamicContent.innerHTML = '';

      if (data.includes('||')) {
        const [mode, content] = data.split('||');

        switch (mode) {
          case 'text':
            renderText(content, dynamicContent);
            break;
          case 'table':
            renderTable(content, dynamicContent);
            break;
          case 'image':
            renderImage(content, dynamicContent);
            break;
          case 'stop':
            renderStop(content, dynamicContent);
            break;
          case 'roll':
            renderRoll(content, dynamicContent);
            break;
          case '3images':
            render3Images(content, dynamicContent);
            break;
          default:
            console.log("Mode non pris en charge");
        }
      } else {
        console.log("Erreur, aucun mode n'est spécifié");
      }
    };


    // Text
    // -----------------------------------------------------
    function renderText(content, container) {
      const paragraphs = content.split('/n').filter(p => p.trim() !== '').map(paragraph => {
        const p = document.createElement('p');
        p.innerText = paragraph;
        return p;
      });
      paragraphs.forEach(paragraph => container.appendChild(paragraph));
    }

    // Table
    // -----------------------------------------------------
    function renderTable(content, container) {
      const [tableTitle, tableContent] = content.includes('~') ? content.split('~') : ['', content];
      const words = tableContent.split('|');

      if (tableTitle) {
        const title = document.createElement('h2');
        title.classList.add('title');
        title.innerText = tableTitle;
        container.appendChild(title);
      }

      const table = document.createElement('table');
      table.classList.add('table');

      for (let i = 0; i < words.length; i += 2) {
        const row = document.createElement('tr');
        const cell1 = document.createElement('td');
        cell1.innerHTML = words[i].trim().split('/n').join('<br>');
        row.appendChild(cell1);

        if (words[i + 1]) {
          const cell2 = document.createElement('td');
          cell2.innerHTML = words[i + 1].trim().split('/n').join('<br>');
          row.appendChild(cell2);
        }

        table.appendChild(row);
      }

      container.appendChild(table);
    }


    // Image
    // -----------------------------------------------------
    function renderImage(content, container) {
      const img = document.createElement('img');
      img.src = content;
      img.style.maxWidth = '100%';
      img.style.maxHeight = '100%';
      img.style.objectFit = 'contain';
      container.appendChild(img);
    }
    
    // 3 images
    // -----------------------------------------------------
    function render3Images(content, container) {
      const images = content.split('|');

      console.log("Images -> " + images)

      if (images.length !== 3) {
        console.error("Le contenu doit contenir exactement trois URL d'images séparées par des virgules.");
        return;
      }

      const imagesContainer = document.createElement('div');
      imagesContainer.classList.add('images-container');

      images.forEach(imageUrl => {
        const img = document.createElement('img');
        img.src = imageUrl.trim();
        img.style.maxWidth = '33%';
        img.style.maxHeight = '100%';
        img.style.objectFit = 'contain';
        imagesContainer.appendChild(img);
      });

      container.appendChild(imagesContainer);
    }

    // STOP
    // -----------------------------------------------------
    function renderStop(stopString, container) {
      const stopMessage = document.createElement('h2');
      stopMessage.classList.add('stopError');
      stopMessage.innerText = stopString;
      container.appendChild(stopMessage);
    }

    // Roll
    // -----------------------------------------------------
    function renderRoll(rollString, container) {
      const rollContent = document.createElement('h2');
      rollContent.classList.add('rollContent');
      rollContent.innerText = rollString;
      container.appendChild(rollContent);
    }
    
    


    function openFullscreen() {
        var elem = document.documentElement;
        if (elem.requestFullscreen) {
          elem.requestFullscreen();
        } else if (elem.webkitRequestFullscreen) { /* Safari */
          elem.webkitRequestFullscreen();
        } else if (elem.msRequestFullscreen) { /* IE11 */
          elem.msRequestFullscreen();
        }
      }

      // Attacher la fonction openFullscreen() à un événement de clic
      document.addEventListener('click', function() {
        openFullscreen();
      });

  </script>
</body>
</html>

<style>
body {
    font-family: Arial, Helvetica, sans-serif;
    background-color: black;
    width: 100vw;
    height: 95vh;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
    transition: all 0.75s ease;
    margin: 0;
}

p {
    color: white;
    font-size: 45px;
    text-align: center;
    width: 100%;
    margin: 0;
}

h2 {
    color: white;
    font-size: 30px;
    text-align: center;
    width: 100%;
    margin: 0;
}

.table {
    color: white;
    text-align: center;
    font-size: 30px;
    border-collapse: collapse;
    border: 2px solid white;
    width: 100%;
    height: 85%;
    table-layout: fixed;
}

.table td {
    padding: 10px;
    border: 1px solid white;
    width: 25%;
}

.title {
    color: white;
    text-align: center;
    margin-bottom: 10px;
}


.stopError{
    color: red;
    text-align: center;
}

.rollContent{
  font-size: 40px;
  color: white;
  text-align: center;
}

#dynamic-content {
  width: 100%;
  height: 100vh;
  display:flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}
</style>