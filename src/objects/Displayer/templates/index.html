<!DOCTYPE html>
<html>
<head>
  <title>Chaîne dynamique</title>
  <link rel="stylesheet" href="./style.css">
</head>
<body>
  <div id="dynamic-content"></div>
  
  <script>
    const eventSource = new EventSource("/stream");
    eventSource.onmessage = (event) => {
      const data = event.data;
      const dynamicContent = document.getElementById('dynamic-content');
      dynamicContent.innerHTML = '';

      if (data.includes('||')) {
        const [mode, content] = data.split('||');

        console.log(mode)


        switch (mode) {
          case 'text':
            renderText(content, dynamicContent);
            break;
          case 'table':
            renderTable(content, dynamicContent);
            break;
          case 'image':
            renderImage(content, dynamicContent);
            break;
          default:
            console.log("Mode non pris en charge");
        }
      } else {
        console.log("Erreur, aucun mode n'est spécifié");
      }
    };

    function renderText(content, container) {
      const paragraphs = content.split('/n').filter(p => p.trim() !== '').map(paragraph => {
        const p = document.createElement('p');
        p.innerText = paragraph;
        return p;
      });
      paragraphs.forEach(paragraph => container.appendChild(paragraph));
    }

    function renderTable(content, container) {
      const [tableTitle, tableContent] = content.includes('~') ? content.split('~') : ['', content];
      const words = tableContent.split('|');

      if (tableTitle) {
        const title = document.createElement('h2');
        title.classList.add('title');
        title.innerText = tableTitle;
        container.appendChild(title);
      }

      const table = document.createElement('table');
      table.classList.add('table');

      for (let i = 0; i < words.length; i += 2) {
        const row = document.createElement('tr');
        const cell1 = document.createElement('td');
        cell1.innerHTML = words[i].trim().split('/n').join('<br>');
        row.appendChild(cell1);

        if (words[i + 1]) {
          const cell2 = document.createElement('td');
          cell2.innerHTML = words[i + 1].trim().split('/n').join('<br>');
          row.appendChild(cell2);
        }

        table.appendChild(row);
      }

      container.appendChild(table);
    }

    function renderImage(content, container) {
      const img = document.createElement('img');
      img.src = content;
      img.style.maxWidth = '100%';
      img.style.maxHeight = '100%';
      img.style.objectFit = 'contain';
      container.appendChild(img);
    }
  </script>
</body>
</html>

<style>
body {
    background-color: black;
    width: 100vw;
    height: 95vh;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
    transition: all 0.75s ease;
    margin: 0;
}

p {
    color: white;
    font-size: 35px;
    text-align: center;
    width: 100%;
    margin: 0;
}

h2 {
    color: white;
    font-size: 30px;
    text-align: center;
    width: 100%;
    margin: 0;
}

.table {
    color: white;
    text-align: center;
    font-size: 30px;
    border-collapse: collapse;
    border: 2px solid white;
    width: 100%;
    height: 85%;
    table-layout: fixed;
}

.table td {
    padding: 10px;
    border: 1px solid white;
    width: 25%;
}

.title {
    color: white;
    text-align: center;
    margin-bottom: 10px;
}

#dynamic-content {
  width: 100%;
  height: 100vh;
  display:flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}
</style>